{% extends "base.html" %}

{% block title %}Stock Explorer{% endblock %}

{% block head %}
<style>
    .stock-item {
        background-color: #fff;
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        font-size: 14px;
        border: 2px solid transparent;
    }
    .stock-item[data-status="Healthy"] {
        border-color: green;
    }
    .stock-item[data-status="Showing Issues"] {
        border-color: rgb(96, 32, 32);
    }
    .stock-item[data-status="Needs refresh"] {
        border-color: red;
    }
    .stock-item[data-status="Ordered"] {
        border-color: blue;
    }
    .stock-item[data-status="No longer maintained"] {
        border-color: pink;
    }
    .stock-item.selected {
        background-color: #c4ecff;
    }
    .stock-item h5 {
        margin: 0 0 5px;
        font-weight: 700;
        font-size: 16px;
    }
    .stock-item p {
        margin: 0;
        font-size: 12px;
    }
    .stock-item .checkbox {
        margin-right: 10px;
    }
    .details {
        padding-top: 10px;
        width: 100%;
    }
    .btn-link.btn-sm {
        font-size: 12px;
        padding: 2px 5px;
        margin-left: 10px;
        color: #007bff;
    }
    .btn-link.btn-sm i {
        font-size: 14px;
    }
    .clearfix::after {
        content: "";
        display: table;
        clear: both;
    }
    .badges {
        margin-top: 5px;
        margin-bottom: 10px;
    }
    .badge-info {
        background-color: #17a2b8;
        color: white;
        margin-right: 5px;
    }
    .badge-secondary {
        background-color: #6c757d;
        color: white;
    }
    .filters {
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
    }
    .filter-row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .filter-col {
        flex: 1;
        min-width: 150px;
    }
</style>
{% endblock %}

{% block content %}
<div class="filters">
    <h3>Filters</h3>
    {% include 'filter_form.html' %}
</div>
<div class="mb-3">
    <a href="/add_stock" class="btn btn-success">Add New Stock</a>
</div>
<div id="stockItems">
    {% for stock in stocks %}
    <div class="stock-item" data-status="{{ stock.Status }}" id="item-{{ loop.index }}">
        <div class="checkbox">
            <input type="checkbox" id="stock{{ loop.index }}">
        </div>
        <div style="flex-grow: 1;">
            <h5>
                {{ stock.SeriesID }}{{ stock.ReplicateID }}
                {% if stock.TrayID and stock.TrayPosition %}
                    <small class="text-muted">({{ stock.TrayID }}-{{ stock.TrayPosition }})</small>
                {% endif %}
                | {{ stock.Name }}
                {% if stock.AltReference %}
                    <span class="text-muted">({{ stock.AltReference }})</span>
                {% endif %}
            </h5>
            <p>
                <strong>Genotype:</strong> {{ stock.Genotype }}<br>
                <strong>Provenance:</strong> {{ stock.Provenance }}<br>
                <strong>Unique Identifier:</strong> <i>{{ stock.UniqueID }}</i>
            </p>
            <div class="badges">
                <span class="badge badge-info">{{ stock.FoodType }}</span>
                <span class="badge badge-secondary">{{ stock.Type }}</span>
            </div>
        </div>
        <div style="display: flex; align-items: center;">
            <button class="btn btn-link btn-sm expand-btn" onclick="toggleDetails({{ loop.index }})">
                <i class="fas fa-chevron-down"></i>
            </button>
            <button class="btn btn-link btn-sm view-details-btn" onclick="viewDetails('{{ stock.UniqueID }}')">
                <i class="fas fa-external-link-alt"></i>
            </button>
        </div>
        <div class="clearfix"></div>
        <div class="details" id="details-{{ loop.index }}" style="display: none; width: 100%;">
            <div style="display: flex; flex-wrap: wrap;">
                <div style="flex: 1;">
                    <p><strong>Source ID:</strong> {{ stock.SourceID }}</p>
                    <p><strong>Comments:</strong> {{ stock.Comments }}</p>
                    <p><strong>Creation Date:</strong> {{ stock.CreationDate }}</p>
                </div>
                <div style="flex: 1;">
                    <p><strong>Last Flip Date:</strong> {{ stock.LastFlipDate }}</p>
                    <p><strong>Flip Log:</strong> {{ stock.FlipLog[-5:]|join(', ') }}</p>
                    <p><strong>Data Modified Date:</strong> {{ stock.DataModifiedDate }}</p>
                    <p><strong>Modification Log:</strong> {{ stock.ModificationLog[-5:]|join(', ') }}</p>
                </div>
            </div>
        </div>
    </div>                                                       
    {% endfor %}
</div>   
<button type="button" id="addToCartBtn" class="btn btn-warning mt-3">Add to Cart</button>
<button type="button" id="selectAllBtn" class="btn btn-info mt-3">Select All</button>
<button type="button" id="deselectAllBtn" class="btn btn-info mt-3">Deselect All</button>
<div id="cart" class="mt-5">
    <h3>Cart</h3>
    <div id="cartItems"></div>
    <button type="button" id="emptyCartBtn" class="btn btn-danger mt-3">Empty Cart</button>
</div>
<form id="generateLabelsForm" method="post" action="/generate_labels" target="_blank">
    <input type="hidden" name="selected_uids" id="selectedUids">
    <input type="hidden" name="blank_spaces" id="blankSpaces">
    <input type="hidden" name="quantities" id="quantities">
    <button type="button" id="generateLabelsBtn" class="btn btn-primary btn-block mt-3">Generate Labels</button>
</form>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
<script src="{{ url_for('static', filename='js/stock_explorer.js') }}"></script>
{% endblock %}
